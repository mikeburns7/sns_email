name: 'Terraform Deploy'
# This is a basic workflow to help you get started with Actions

on:
  push:
    branches:
      - main
  pull_request:

env:
  AWS_REGION : "us-east-1" #Change to reflect your Region

permissions:
  id-token: write   # This is required for requesting the JWT
  contents: read
  pull-requests: write
  
jobs:
  AssumeRoleAndCallIdentity:
      runs-on: ubuntu-latest
      steps:
        - name: Git clone the repository
          uses: actions/checkout@v3
        - name: configure aws credentials
          uses: aws-actions/configure-aws-credentials@v1.7.0
          with:
            role-to-assume: arn:aws:iam::792629419413:role/github_deploy #change to reflect your IAM roleâ€™s ARN
            role-session-name: GitHub_to_AWS_via_FederatedOIDC
            aws-region: ${{ env.AWS_REGION }}
        # Hello from AWS: WhoAmI
        - name: Sts GetCallerIdentity
          run: |
            aws sts get-caller-identity
 # terraform:
  #  name: 'Terraform'
   # runs-on: ubuntu-latest

  #  steps:
  #  - name: Checkout
  #    uses: actions/checkout@v3

  #  - name: Setup Terraform
  #    uses: hashicorp/setup-terraform@v2

 #   - name: Terraform Init
 #     run: terraform init

 #   - name: Terraform Format
 #     run: terraform fmt -check

#    - name: Terraform Plan
#     run: terraform plan -no-color
#      if: github.event_name == 'pull_request'

#    - name: Terraform Apply
#      if: github.ref == 'refs/heads/main' && github.event_name == 'push'
#      run: terraform apply -auto-approve

    